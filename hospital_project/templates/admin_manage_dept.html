{% extends 'admin_navbar.html' %}
{% load static %}
{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<title>Manage Departments</title>

<style>
    #bg-card {
        background: rgba(255,255,255,0.85);
        padding: 25px;
        border-radius: 10px;
        margin-top: 120px;
    }
    table {
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    }
    th {
        background-color: #0d6efd;
        color: white;
        text-align: center;
    }
    td {
        text-align: center;
    }
</style>

<div class="container" style="min-height: 90vh;">
    {% if messages %}
        <div class="alert alert-success alert-dismissible">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        </div>
    {% endif %}
    <div id="bg-card" class="shadow">
        
        
        <h2 class="text-center mb-4">Manage Departments</h2>
        <div id="ajax-alert"></div>

        <div class="row mb-4">
            <div class="col-md-8 mb-3">
                <input type="text" id="dept_name" class="form-control" placeholder="Enter Department Name">
            </div>
            <div class="col-md-4">
                <button id="add_btn" class="btn btn-success btn-block">Add Department</button>
                <button id="update_btn" class="btn btn-success btn-block" style="display: none; margin-top: -1px;">Update</button>
            </div>
        </div>

        <div id="department_table">
            {% include 'components/department_table.html' %}
        </div>

    </div>
</div>


<script>
    let edit_id = null;
    $("#add_btn").click(function () {
        let name = $("#dept_name").val().trim();

        if (name === "") {
            alert("Department name cannot be empty!");
            return;
        }

        $.ajax({
            url: "{% url 'add_department' %}",
            method: "POST",
            data: {
                dept_name: name,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                $("#department_table").html(response.table_html);
                $("#dept_name").val("");
            }
        });
    });

    function deleteDepartment(id) {
        $.ajax({
            url: "{% url 'delete_department' %}",
            method: "POST",
            data: {
                dept_id: id,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                $("#department_table").html(response.table_html);
            }
        });
    }

    function editDepartment(id) {
        edit_id = id;
        $.ajax({
            type: 'GET',
            url: "{% url 'edit_department' %}?id=" + id,
            success: function(data){
                $('#dept_name').val(data.Dept_name);
                $('#add_btn').hide();
                $('#update_btn').show();
            }
        })
    }

    $("#update_btn").click(function () {
        let name = $("#dept_name").val().trim();

        if (name === "") {
            alert("Department name cannot be empty!");
            return;
        }

        $.ajax({
            type: 'POST',
            url: "{% url 'edit_department' %}",
            data: {
                dept_id: edit_id,
                dept_name: name,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                $("#department_table").html(response.table_html);
                $("#dept_name").val("");
                $("#ajax-alert").html(`
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        ${response.message}
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                    </div>
                `);
            }
        })
        $('#add_btn').show();
        $('#update_btn').hide();
    });
</script>

{% endblock %}
